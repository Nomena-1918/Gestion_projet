import{_ as j,a as c,o as n,c as d,b as t,t as u,h as D,w as p,v as m,F as f,r as g,e as b,f as C,d as P,n as S}from"./index-c433af20.js";const y={name:"CreationComedien",data(){return{formData:{nom:"",age:null,email:"",projetId:"",photo:null,disponibilites:[]},comediens:[],filteredComediens:[],projets:[],filteredProjets:[],isEditing:!1,editingId:null,isSubmitting:!1,loading:!1,previewPhoto:null,currentPhotoFile:null,projetSearch:"",showProjetSuggestions:!1,comedienSearch:"",selectedProjetFilter:"",selectedStatutFilter:""}},async mounted(){await this.loadProjets(),await this.loadComediens()},methods:{async loadProjets(){try{const s=await c.get("/api/projets");this.projets=s.data,this.filteredProjets=this.projets}catch(s){console.error("Erreur lors du chargement des projets:",s)}},async loadComediens(){this.loading=!0;try{const s=await c.get("/api/comediens");this.comediens=s.data,this.filteredComediens=this.comediens}catch(s){console.error("Erreur lors du chargement des comÃ©diens:",s),alert("Erreur lors du chargement des comÃ©diens")}finally{this.loading=!1}},filterProjets(){if(this.projetSearch.trim()==="")this.filteredProjets=this.projets;else{const s=this.projetSearch.toLowerCase();this.filteredProjets=this.projets.filter(e=>e.titre.toLowerCase().includes(s))}},selectProjet(s){this.formData.projetId=s.id,this.projetSearch=s.titre,this.showProjetSuggestions=!1},filterComediens(){let s=this.comediens;if(this.comedienSearch.trim()!==""){const e=this.comedienSearch.toLowerCase();s=s.filter(l=>l.nom.toLowerCase().includes(e)||l.email.toLowerCase().includes(e)||l.projetTitre&&l.projetTitre.toLowerCase().includes(e))}this.selectedProjetFilter!==""&&(s=s.filter(e=>e.projetId==this.selectedProjetFilter)),this.selectedStatutFilter!==""&&(s=s.filter(e=>e.disponibilites&&e.disponibilites.some(l=>l.statut===this.selectedStatutFilter))),this.filteredComediens=s},getPhotoUrl(s){return`/api/comediens/photo/${s}`},handlePhotoUpload(s){const e=s.target.files[0];if(e){this.currentPhotoFile=e;const l=new FileReader;l.onload=h=>{this.previewPhoto=h.target.result},l.readAsDataURL(e)}},removePhoto(){this.previewPhoto=null,this.currentPhotoFile=null,this.$refs.photoInput.value=""},addDisponibilite(){this.formData.disponibilites.push({date:"",statut:"DISPONIBLE"})},removeDisponibilite(s){this.formData.disponibilites.splice(s,1)},async submitForm(){var s,e;this.isSubmitting=!0;try{const l=new FormData;if(this.formData.nom&&l.append("nom",this.formData.nom),this.formData.age&&l.append("age",this.formData.age),this.formData.email&&l.append("email",this.formData.email),this.formData.projetId&&l.append("projetId",this.formData.projetId),this.currentPhotoFile&&l.append("photo",this.currentPhotoFile),this.isEditing&&this.formData.disponibilites.length>0){const o=this.formData.disponibilites[0];o.date&&(l.append("dateDisponibilite",o.date),l.append("statutDisponibilite",o.statut))}let h;this.isEditing?(h=await c.put(`/api/comediens/${this.editingId}`,l,{headers:{"Content-Type":"multipart/form-data"}}),alert("ComÃ©dien modifiÃ© avec succÃ¨s")):(h=await c.post("/api/comediens",l,{headers:{"Content-Type":"multipart/form-data"}}),alert("ComÃ©dien crÃ©Ã© avec succÃ¨s")),this.resetForm(),await this.loadComediens()}catch(l){console.error("Erreur lors de la sauvegarde:",l),alert("Erreur lors de la sauvegarde: "+(((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||l.message))}finally{this.isSubmitting=!1}},editComedien(s){this.originalData={...s},this.formData={nom:s.nom,age:s.age,email:s.email,projetId:s.projetId,disponibilites:s.disponibilites?[...s.disponibilites]:[]};const e=this.projets.find(l=>l.id===s.projetId);this.projetSearch=e?e.titre:"",s.photoPath?this.previewPhoto=this.getPhotoUrl(s.photoPath):this.previewPhoto=null,this.currentPhotoFile=null,this.isEditing=!0,this.editingId=s.id,document.querySelector(".form-container").scrollIntoView({behavior:"smooth"})},async deleteComedien(s){if(confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce comÃ©dien ?"))try{await c.delete(`/api/comediens/${s}`),alert("ComÃ©dien supprimÃ© avec succÃ¨s"),await this.loadComediens()}catch(e){console.error("Erreur lors de la suppression:",e),alert("Erreur lors de la suppression")}},resetForm(){this.formData={nom:"",age:null,email:"",projetId:"",photo:null,disponibilites:[]},this.projetSearch="",this.previewPhoto=null,this.currentPhotoFile=null,this.isEditing=!1,this.editingId=null,this.$refs.photoInput.value="",this.showProjetSuggestions=!1},formatDate(s){return new Date(s).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})},formatDateSimple(s){return new Date(s).toLocaleDateString("fr-FR")},getStatutClass(s){switch(s){case"DISPONIBLE":return"statut-disponible";case"INDISPONIBLE":return"statut-indisponible";case"OCCUPE":return"statut-occupe";default:return""}},getStatutText(s){switch(s){case"DISPONIBLE":return"Disponible";case"INDISPONIBLE":return"Indisponible";case"OCCUPE":return"OccupÃ©";default:return s}},goToSceneComedien(s){this.$router.push({path:"/scene-comedien",query:{comedienId:s}})}},watch:{showProjetSuggestions(s){s?setTimeout(()=>{document.addEventListener("click",this.closeProjetSuggestions)},100):document.removeEventListener("click",this.closeProjetSuggestions)}},beforeUnmount(){document.removeEventListener("click",this.closeProjetSuggestions)}},I={class:"creation-comedien"},_={class:"form-container"},w={class:"form-group"},F={class:"form-group"},k={class:"form-group"},E={class:"form-group"},L={class:"search-container"},U={key:0,class:"suggestions-dropdown"},N=["onClick"],O={class:"form-group"},T={class:"photo-upload"},V={for:"photo",class:"photo-label"},x={key:0},B={key:1},A={key:0,class:"photo-preview"},R=["src"],M={class:"form-group disponibilites-section"},q={class:"disponibilites-list"},z={class:"disponibilite-inputs"},G=["onUpdate:modelValue"],H=["onUpdate:modelValue"],J=["onClick"],K={class:"form-actions"},Q=["disabled"],W={class:"comediens-list"},X={class:"list-header"},Y={class:"search-section"},Z={class:"search-group"},$={class:"filters-group"},ee={class:"filter-item"},te=["value"],ie={class:"filter-item"},se={key:0,class:"loading"},oe={key:1,class:"empty-state"},re={key:0},le={key:1},ne={key:2,class:"comediens-grid"},de={class:"comedien-photo"},ae=["src","alt"],ue={key:1,class:"photo-placeholder"},pe={class:"comedien-info"},me={key:0,class:"disponibilites-display"},he={class:"dispo-date"},ce={key:1,class:"no-disponibilites"},fe={class:"date-info"},ge={class:"comedien-actions"},ve=["onClick"],be=["onClick"],Ce=["onClick"];function Pe(s,e,l,h,o,r){return n(),d("div",I,[e[35]||(e[35]=t("h2",null,"CrÃ©ation et Gestion des ComÃ©diens",-1)),t("div",_,[t("h3",null,u(o.isEditing?"Modifier":"CrÃ©er")+" un comÃ©dien",1),t("form",{onSubmit:e[11]||(e[11]=D((...i)=>r.submitForm&&r.submitForm(...i),["prevent"])),class:"comedien-form",enctype:"multipart/form-data"},[t("div",w,[e[18]||(e[18]=t("label",{for:"nom"},"Nom du comÃ©dien *",-1)),p(t("input",{type:"text",id:"nom","onUpdate:modelValue":e[0]||(e[0]=i=>o.formData.nom=i),required:"",placeholder:"Entrez le nom du comÃ©dien"},null,512),[[m,o.formData.nom]])]),t("div",F,[e[19]||(e[19]=t("label",{for:"age"},"Ã‚ge",-1)),p(t("input",{type:"number",id:"age","onUpdate:modelValue":e[1]||(e[1]=i=>o.formData.age=i),placeholder:"Ã‚ge du comÃ©dien"},null,512),[[m,o.formData.age]])]),t("div",k,[e[20]||(e[20]=t("label",{for:"email"},"Email *",-1)),p(t("input",{type:"email",id:"email","onUpdate:modelValue":e[2]||(e[2]=i=>o.formData.email=i),required:"",placeholder:"email@exemple.com"},null,512),[[m,o.formData.email]])]),t("div",E,[e[21]||(e[21]=t("label",{for:"projetSearch"},"Projet *",-1)),t("div",L,[p(t("input",{type:"text",id:"projetSearch","onUpdate:modelValue":e[3]||(e[3]=i=>o.projetSearch=i),onInput:e[4]||(e[4]=(...i)=>r.filterProjets&&r.filterProjets(...i)),onFocus:e[5]||(e[5]=i=>o.showProjetSuggestions=!0),placeholder:"Rechercher un projet...",class:"search-input"},null,544),[[m,o.projetSearch]]),o.showProjetSuggestions&&o.filteredProjets.length>0?(n(),d("div",U,[(n(!0),d(f,null,g(o.filteredProjets,i=>(n(),d("div",{key:i.id,onClick:a=>r.selectProjet(i),class:"suggestion-item"},u(i.titre),9,N))),128))])):b("",!0)]),p(t("input",{type:"hidden","onUpdate:modelValue":e[6]||(e[6]=i=>o.formData.projetId=i),required:""},null,512),[[m,o.formData.projetId]])]),t("div",O,[e[22]||(e[22]=t("label",{for:"photo"},"Photo",-1)),t("div",T,[t("input",{type:"file",id:"photo",ref:"photoInput",onChange:e[7]||(e[7]=(...i)=>r.handlePhotoUpload&&r.handlePhotoUpload(...i)),accept:"image/*",class:"photo-input"},null,544),t("label",V,[o.previewPhoto?(n(),d("span",B,"ğŸ“· Changer la photo")):(n(),d("span",x,"ğŸ“· Choisir une photo"))]),o.previewPhoto?(n(),d("div",A,[t("img",{src:o.previewPhoto,alt:"AperÃ§u de la photo",class:"preview-image"},null,8,R),t("button",{type:"button",onClick:e[8]||(e[8]=(...i)=>r.removePhoto&&r.removePhoto(...i)),class:"remove-photo-btn"},"Ã—")])):b("",!0)])]),t("div",M,[e[24]||(e[24]=t("label",null,"DisponibilitÃ©s",-1)),t("div",q,[(n(!0),d(f,null,g(o.formData.disponibilites,(i,a)=>(n(),d("div",{key:a,class:"disponibilite-item"},[t("div",z,[p(t("input",{type:"date","onUpdate:modelValue":v=>i.date=v,class:"date-input",placeholder:"Date"},null,8,G),[[m,i.date]]),p(t("select",{"onUpdate:modelValue":v=>i.statut=v,class:"statut-select"},[...e[23]||(e[23]=[t("option",{value:"DISPONIBLE"},"Disponible",-1),t("option",{value:"INDISPONIBLE"},"Indisponible",-1),t("option",{value:"OCCUPE"},"OccupÃ©",-1)])],8,H),[[C,i.statut]]),t("button",{type:"button",onClick:v=>r.removeDisponibilite(a),class:"remove-dispo-btn",title:"Supprimer"}," Ã— ",8,J)])]))),128))]),t("button",{type:"button",onClick:e[9]||(e[9]=(...i)=>r.addDisponibilite&&r.addDisponibilite(...i)),class:"btn-add-dispo"}," + Ajouter une disponibilitÃ© ")]),t("div",K,[t("button",{type:"submit",disabled:o.isSubmitting,class:"btn-primary"},u(o.isEditing?"Modifier":"CrÃ©er")+" le comÃ©dien ",9,Q),o.isEditing?(n(),d("button",{key:0,type:"button",onClick:e[10]||(e[10]=(...i)=>r.resetForm&&r.resetForm(...i)),class:"btn-secondary"}," Annuler ")):b("",!0)])],32)]),t("div",W,[t("div",X,[e[30]||(e[30]=t("h3",null,"Liste des comÃ©diens",-1)),t("div",Y,[t("div",Z,[e[25]||(e[25]=t("label",{for:"comedienSearch"},"Rechercher un comÃ©dien",-1)),p(t("input",{type:"text",id:"comedienSearch","onUpdate:modelValue":e[12]||(e[12]=i=>o.comedienSearch=i),onInput:e[13]||(e[13]=(...i)=>r.filterComediens&&r.filterComediens(...i)),placeholder:"Rechercher par nom, email ou projet...",class:"search-input"},null,544),[[m,o.comedienSearch]])]),t("div",$,[t("div",ee,[e[27]||(e[27]=t("label",{for:"projetFilter"},"Filtrer par projet",-1)),p(t("select",{id:"projetFilter","onUpdate:modelValue":e[14]||(e[14]=i=>o.selectedProjetFilter=i),onChange:e[15]||(e[15]=(...i)=>r.filterComediens&&r.filterComediens(...i)),class:"filter-select"},[e[26]||(e[26]=t("option",{value:""},"Tous les projets",-1)),(n(!0),d(f,null,g(o.projets,i=>(n(),d("option",{key:i.id,value:i.id},u(i.titre),9,te))),128))],544),[[C,o.selectedProjetFilter]])]),t("div",ie,[e[29]||(e[29]=t("label",{for:"statutFilter"},"Filtrer par statut",-1)),p(t("select",{id:"statutFilter","onUpdate:modelValue":e[16]||(e[16]=i=>o.selectedStatutFilter=i),onChange:e[17]||(e[17]=(...i)=>r.filterComediens&&r.filterComediens(...i)),class:"filter-select"},[...e[28]||(e[28]=[t("option",{value:""},"Tous les statuts",-1),t("option",{value:"DISPONIBLE"},"Disponible",-1),t("option",{value:"INDISPONIBLE"},"Indisponible",-1),t("option",{value:"OCCUPE"},"OccupÃ©",-1)])],544),[[C,o.selectedStatutFilter]])])])])]),o.loading?(n(),d("div",se,"Chargement...")):o.filteredComediens.length===0?(n(),d("div",oe,[o.comedienSearch||o.selectedProjetFilter||o.selectedStatutFilter?(n(),d("div",re," Aucun comÃ©dien ne correspond Ã  vos critÃ¨res de recherche. ")):(n(),d("div",le," Aucun comÃ©dien crÃ©Ã© pour le moment. "))])):(n(),d("div",ne,[(n(!0),d(f,null,g(o.filteredComediens,i=>(n(),d("div",{key:i.id,class:"comedien-card"},[t("div",de,[i.photoPath?(n(),d("img",{key:0,src:r.getPhotoUrl(i.photoPath),alt:i.nom,class:"photo"},null,8,ae)):(n(),d("div",ue,"ğŸ“·"))]),t("div",pe,[t("h4",null,u(i.nom),1),t("p",null,[e[31]||(e[31]=t("strong",null,"Ã‚ge:",-1)),P(" "+u(i.age)+" ans",1)]),t("p",null,[e[32]||(e[32]=t("strong",null,"Email:",-1)),P(" "+u(i.email),1)]),t("p",null,[e[33]||(e[33]=t("strong",null,"Projet:",-1)),P(" "+u(i.projetTitre||"Non assignÃ©"),1)]),i.disponibilites&&i.disponibilites.length>0?(n(),d("div",me,[e[34]||(e[34]=t("strong",null,"DisponibilitÃ©s:",-1)),(n(!0),d(f,null,g(i.disponibilites,a=>(n(),d("div",{key:a.id,class:"dispo-item"},[t("span",he,u(r.formatDateSimple(a.date)),1),t("span",{class:S(["dispo-statut",r.getStatutClass(a.statut)])},u(r.getStatutText(a.statut)),3)]))),128))])):(n(),d("p",ce,"Aucune disponibilitÃ© dÃ©finie")),t("p",fe," CrÃ©Ã© le: "+u(r.formatDate(i.creeLe)),1)]),t("div",ge,[t("button",{onClick:a=>r.editComedien(i),class:"btn-edit",title:"Modifier"}," âœï¸ ",8,ve),t("button",{onClick:a=>r.goToSceneComedien(i.id),class:"btn-link",title:"Lier Ã  une scÃ¨ne"}," ğŸ¬ ",8,be),t("button",{onClick:a=>r.deleteComedien(i.id),class:"btn-delete",title:"Supprimer"}," ğŸ—‘ï¸ ",8,Ce)])]))),128))]))])])}const De=j(y,[["render",Pe],["__scopeId","data-v-f4dc6904"]]);export{De as default};
