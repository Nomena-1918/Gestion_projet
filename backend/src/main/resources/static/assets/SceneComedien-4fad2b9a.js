import{_ as L,a as u,A as v,o as l,c,b as t,h as C,w as h,v as p,F as f,r as w,e as g,n as b,t as a,d as S}from"./index-c433af20.js";const y={data(){return{user:JSON.parse(localStorage.getItem("user"))||null,showProfileMenu:!1,newLiaison:{idComedien:"",idScene:""},selectedComedien:null,scenes:[],filteredScenesList:[],liaisons:[],searchTerm:"",sceneSearch:"",showSceneDropdown:!1,selectedScene:null}},computed:{userInitials(){var e;return(e=this.user)!=null&&e.nom?this.user.nom.split(" ").map(r=>r[0]).join("").toUpperCase():""},filteredLiaisons(){return this.searchTerm?this.liaisons.filter(s=>s.comedienNom.toLowerCase().includes(this.searchTerm.toLowerCase())||s.sceneTitre.toLowerCase().includes(this.searchTerm.toLowerCase())):this.liaisons},selectedComedienName(){return this.selectedComedien?`${this.selectedComedien.nom} (${this.selectedComedien.email})`:"Chargement..."},groupedLiaisons(){const s={};return this.filteredLiaisons.forEach(e=>{s[e.idComedien]||(s[e.idComedien]={id:e.idComedien,nom:e.comedienNom,scenes:[]}),s[e.idComedien].scenes.push(e)}),Object.values(s)}},async created(){u.defaults.baseURL=v,u.interceptors.request.use(e=>{const r=localStorage.getItem("token");return r&&(e.headers.Authorization=`Bearer ${r}`),e},e=>Promise.reject(e));const s=this.$route.query.comedienId;s&&(this.newLiaison.idComedien=s,await this.loadSelectedComedien(s)),await this.loadData(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},methods:{async loadData(){try{await Promise.all([this.loadScenes(),this.loadLiaisons()]),this.filteredScenesList=this.scenes}catch(s){console.error("Erreur lors du chargement des donnÃ©es:",s),alert("Erreur lors du chargement des donnÃ©es")}},async loadSelectedComedien(s){try{const e=await u.get(`/api/comediens/${s}`);this.selectedComedien=e.data}catch(e){console.error("Erreur lors du chargement du comÃ©dien:",e),alert("ComÃ©dien non trouvÃ©"),this.goBack()}},async loadScenes(){try{const s=await u.get("/api/scenes");this.scenes=s.data}catch(s){console.error("Erreur lors du chargement des scÃ¨nes:",s)}},async loadLiaisons(){try{const s=await u.get("/api/comedien-scene");this.liaisons=s.data}catch(s){console.error("Erreur lors du chargement des liaisons:",s)}},filterScenes(){if(!this.sceneSearch){this.filteredScenesList=this.scenes;return}const s=this.sceneSearch.toLowerCase();this.filteredScenesList=this.scenes.filter(e=>e.titre.toLowerCase().includes(s)||e.sequenceTitre.toLowerCase().includes(s)||e.statutNom.toLowerCase().includes(s))},selectScene(s){this.newLiaison.idScene=s.idScene,this.selectedScene=s,this.sceneSearch=`${s.titre} - ${s.sequenceTitre} (${s.statutNom})`,this.showSceneDropdown=!1},onSceneInputBlur(){setTimeout(()=>{this.showSceneDropdown=!1},200)},async submitForm(){var s,e;if(!this.newLiaison.idScene){alert("Veuillez sÃ©lectionner une scÃ¨ne");return}try{await u.post("/api/comedien-scene",this.newLiaison),this.resetForm(),await this.loadLiaisons(),alert("Association crÃ©Ã©e avec succÃ¨s!")}catch(r){console.error("Erreur lors de la crÃ©ation de l'association:",r),alert("Erreur: "+(((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.message)||r.message))}},resetForm(){this.newLiaison.idScene="",this.sceneSearch="",this.selectedScene=null,this.filteredScenesList=this.scenes},async deleteLiaison(s){var e,r;if(confirm("ÃŠtes-vous sÃ»r de vouloir supprimer cette association ?"))try{await u.delete(`/api/comedien-scene/${s}`),await this.loadLiaisons(),alert("Association supprimÃ©e avec succÃ¨s!")}catch(m){console.error("Erreur lors de la suppression:",m),alert("Erreur: "+(((r=(e=m.response)==null?void 0:e.data)==null?void 0:r.message)||m.message))}},formatDate(s){return s?new Date(s).toLocaleDateString("fr-FR"):""},goBack(){this.$router.push("/creation-comedien")},toggleProfileMenu(){this.showProfileMenu=!this.showProfileMenu},handleClickOutside(s){s.target.closest(".profile-section")||(this.showProfileMenu=!1),s.target.closest(".combobox-container")||(this.showSceneDropdown=!1)},seDeconnecter(){localStorage.removeItem("user"),localStorage.removeItem("token"),this.$router.push("/")}}},_={class:"scene-comedien-container"},k={class:"main-content"},D={class:"page-header"},T={class:"liaison-form"},x={class:"form-group"},E=["value"],B={class:"form-group"},I={class:"combobox-container"},A={key:0,class:"combobox-dropdown"},N=["onMousedown"],F={key:0,class:"combobox-no-results"},M={class:"liaisons-list"},q={class:"filters"},P={class:"filter-group"},V={class:"comedien-header"},U={class:"scene-count"},R={class:"scenes-container"},O={class:"scene-info"},j={class:"scene-actions"},z=["onClick"],J={key:0,class:"empty-state"};function G(s,e,r,m,i,o){return l(),c("div",_,[t("main",k,[t("div",D,[t("button",{onClick:e[0]||(e[0]=(...n)=>o.goBack&&o.goBack(...n)),class:"back-btn"},"â† Retour"),e[9]||(e[9]=t("h2",null,"Lier ComÃ©dien Ã  une ScÃ¨ne",-1))]),t("div",T,[e[13]||(e[13]=t("h3",null,"Associer un comÃ©dien Ã  une scÃ¨ne",-1)),t("form",{onSubmit:e[7]||(e[7]=C((...n)=>o.submitForm&&o.submitForm(...n),["prevent"]))},[t("div",x,[e[10]||(e[10]=t("label",null,"ComÃ©dien:",-1)),t("input",{value:o.selectedComedienName,type:"text",disabled:"",class:"comedien-disabled-input"},null,8,E),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>i.newLiaison.idComedien=n),type:"hidden"},null,512),[[p,i.newLiaison.idComedien]])]),t("div",B,[e[11]||(e[11]=t("label",null,"ScÃ¨ne:",-1)),t("div",I,[h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>i.sceneSearch=n),onInput:e[3]||(e[3]=(...n)=>o.filterScenes&&o.filterScenes(...n)),onFocus:e[4]||(e[4]=n=>i.showSceneDropdown=!0),onBlur:e[5]||(e[5]=(...n)=>o.onSceneInputBlur&&o.onSceneInputBlur(...n)),placeholder:"Rechercher une scÃ¨ne...",class:"combobox-input",required:""},null,544),[[p,i.sceneSearch]]),i.showSceneDropdown?(l(),c("div",A,[(l(!0),c(f,null,w(i.filteredScenesList,n=>(l(),c("div",{key:n.idScene,onMousedown:d=>o.selectScene(n),class:b(["combobox-option",{selected:i.newLiaison.idScene===n.idScene}])},a(n.titre)+" - "+a(n.sequenceTitre)+" ("+a(n.statutNom)+") ",43,N))),128)),i.filteredScenesList.length===0?(l(),c("div",F," Aucune scÃ¨ne trouvÃ©e ")):g("",!0)])):g("",!0)]),h(t("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>i.newLiaison.idScene=n),type:"hidden"},null,512),[[p,i.newLiaison.idScene]])]),e[12]||(e[12]=t("button",{type:"submit",class:"submit-btn"},"Associer",-1))],32)]),t("div",M,[e[18]||(e[18]=t("h3",null,"Associations ComÃ©dien-ScÃ¨ne",-1)),t("div",q,[t("div",P,[h(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>i.searchTerm=n),type:"text",placeholder:"Rechercher par nom..."},null,512),[[p,i.searchTerm]])])]),(l(!0),c(f,null,w(o.groupedLiaisons,n=>(l(),c("div",{class:"comedien-group",key:n.id},[t("div",V,[t("h4",null,a(n.nom),1),t("span",U,a(n.scenes.length)+" scÃ¨ne(s)",1)]),t("div",R,[(l(!0),c(f,null,w(n.scenes,d=>(l(),c("div",{key:d.id,class:"scene-card"},[t("div",O,[t("p",null,[e[14]||(e[14]=t("strong",null,"ScÃ¨ne:",-1)),S(" "+a(d.sceneTitre),1)]),t("p",null,[e[15]||(e[15]=t("strong",null,"SÃ©quence:",-1)),S(" "+a(d.sequenceTitre),1)]),t("p",null,[e[16]||(e[16]=t("strong",null,"Statut:",-1)),S(" "+a(d.sceneStatut),1)]),t("p",null,[e[17]||(e[17]=t("strong",null,"CrÃ©Ã© le:",-1)),S(" "+a(o.formatDate(d.creeLe)),1)])]),t("div",j,[t("button",{onClick:H=>o.deleteLiaison(d.id),class:"btn-delete-scene",title:"Supprimer"}," ğŸ—‘ï¸ ",8,z)])]))),128))])]))),128)),o.groupedLiaisons.length===0?(l(),c("div",J," Aucune association comÃ©dien-scÃ¨ne trouvÃ©e. ")):g("",!0)])])])}const Q=L(y,[["render",G],["__scopeId","data-v-debc3c08"]]);export{Q as default};
