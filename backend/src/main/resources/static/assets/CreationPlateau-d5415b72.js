import{_ as I,a as d,A as P,o as l,c as n,b as s,t as a,h as S,w as m,v as h,F as g,r as v,e as p,f as x,g as L,d as c}from"./index-c433af20.js";const w={name:"CreationPlateau",data(){return{user:JSON.parse(localStorage.getItem("user"))||null,showProfileMenu:!1,formData:{lieuId:"",sceneId:"",nom:"",typePlateau:"",description:""},isEditing:!1,editingId:null,lieux:[],scenes:[],plateaux:[],searchTerm:"",filterLieuId:"",filterTypePlateau:"",loading:!0,lieuSearch:"",showLieuSuggestions:!1,filteredLieux:[]}},computed:{userInitials(){var e;return(e=this.user)!=null&&e.nom?this.user.nom.split(" ").map(o=>o[0]).join("").toUpperCase():""},filteredPlateaux(){return this.plateaux.filter(t=>{const e=t.nom.toLowerCase().includes(this.searchTerm.toLowerCase()),o=!this.filterLieuId||t.lieuId===parseInt(this.filterLieuId),f=!this.filterTypePlateau||t.typePlateau===this.filterTypePlateau;return e&&o&&f})},scenesFiltrees(){if(!this.formData.lieuId)return[];const t=this.lieux.find(e=>e.id===parseInt(this.formData.lieuId));return t?this.scenes.filter(e=>e.projetId===t.projetId):[]}},async created(){d.defaults.baseURL=P,d.interceptors.request.use(t=>{const e=localStorage.getItem("token");return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t)),await this.loadLieux(),await this.loadScenes(),await this.loadPlateaux(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},watch:{lieux:{handler(t){this.filteredLieux=[...t]},deep:!0}},methods:{async loadLieux(){try{const t=await d.get("/api/lieux");this.lieux=t.data,this.filteredLieux=[...this.lieux]}catch(t){console.error("Erreur lors du chargement des lieux:",t),alert("Erreur lors du chargement des lieux")}},async loadScenes(){try{const t=await d.get("/api/scenes");this.scenes=t.data}catch(t){console.error("Erreur lors du chargement des sc√®nes:",t),alert("Erreur lors du chargement des sc√®nes")}},async loadPlateaux(){var t,e;this.loading=!0;try{const o=await d.get("/api/plateaux");this.plateaux=o.data}catch(o){console.error("Erreur lors du chargement des plateaux:",o),alert("Erreur lors du chargement des plateaux: "+(((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||o.message))}finally{this.loading=!1}},async submitForm(){var t,e;try{const o={...this.formData,lieuId:parseInt(this.formData.lieuId),sceneId:this.formData.sceneId?parseInt(this.formData.sceneId):null};this.isEditing?(await d.put(`/api/plateaux/${this.editingId}`,o),alert("Plateau modifi√© avec succ√®s!")):(await d.post("/api/plateaux",o),alert("Plateau cr√©√© avec succ√®s!")),this.resetForm(),await this.loadPlateaux()}catch(o){console.error("Erreur lors de la sauvegarde du plateau:",o),alert("Erreur: "+(((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||o.message))}},editPlateau(t){this.formData={lieuId:t.lieuId.toString(),sceneId:t.sceneId?t.sceneId.toString():"",nom:t.nom,typePlateau:t.typePlateau,description:t.description||""},this.lieuSearch=this.getLieuName(t.lieuId),this.isEditing=!0,this.editingId=t.id,document.querySelector(".creation-form").scrollIntoView({behavior:"smooth"})},async deletePlateau(t){var e,o;if(confirm("√ätes-vous s√ªr de vouloir supprimer ce plateau ?"))try{await d.delete(`/api/plateaux/${t}`),await this.loadPlateaux(),alert("Plateau supprim√© avec succ√®s!")}catch(f){console.error("Erreur lors de la suppression du plateau:",f),alert("Erreur: "+(((o=(e=f.response)==null?void 0:e.data)==null?void 0:o.message)||f.message))}},resetForm(){this.formData={lieuId:"",sceneId:"",nom:"",typePlateau:"",description:""},this.lieuSearch="",this.isEditing=!1,this.editingId=null,this.filteredLieux=[...this.lieux]},formatDate(t){return t?new Date(t).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""},onLieuChange(){this.formData.sceneId=""},goBack(){this.$router.push("/scenariste")},toggleProfileMenu(){this.showProfileMenu=!this.showProfileMenu},handleClickOutside(t){t.target.closest(".profile-section")||(this.showProfileMenu=!1)},seDeconnecter(){localStorage.removeItem("user"),localStorage.removeItem("token"),this.$router.push("/")},filterLieux(){const t=this.lieuSearch.toLowerCase();if(!t){this.filteredLieux=[...this.lieux];return}this.filteredLieux=this.lieux.filter(e=>e.nomLieu.toLowerCase().includes(t)||e.projetTitre.toLowerCase().includes(t))},selectLieu(t){this.formData.lieuId=t.id.toString(),this.lieuSearch=`${t.nomLieu} - ${t.projetTitre}`,this.showLieuSuggestions=!1,this.onLieuChange()},hideLieuSuggestions(){setTimeout(()=>{this.showLieuSuggestions=!1},200)},getLieuName(t){const e=this.lieux.find(o=>o.id===parseInt(t));return e?`${e.nomLieu} - ${e.projetTitre}`:""}}},k={class:"creation-plateau-container"},D={class:"main-content"},T={class:"page-header"},b={class:"creation-form"},E={class:"form-group"},_={class:"combobox-container"},C=["placeholder"],V={key:0,class:"suggestions-list"},N=["onMousedown"],j={key:1,class:"suggestions-list"},F={class:"form-group"},M={class:"form-group"},U={class:"form-group"},A={type:"submit",class:"submit-btn"},B={class:"plateaux-list"},q={class:"filters"},R={class:"filter-group"},O={class:"filter-group"},z=["value"],G={class:"filter-group"},J={key:0,class:"loading"},H={key:1,class:"no-data"},K={key:2,class:"plateaux-grid"},Q={class:"plateau-header"},W={class:"plateau-actions"},X=["onClick"],Y=["onClick"],Z={class:"plateau-info"},$={key:0},ee={key:1},te={key:2},ie={key:3},se={key:4};function re(t,e,o,f,r,u){return l(),n("div",k,[s("main",D,[s("div",T,[s("button",{onClick:e[0]||(e[0]=(...i)=>u.goBack&&u.goBack(...i)),class:"back-btn"},"‚Üê Retour"),e[13]||(e[13]=s("h2",null,"Gestion des Plateaux",-1))]),s("div",b,[s("h3",null,a(r.isEditing?"Modifier":"Ajouter")+" un plateau",1),s("form",{onSubmit:e[9]||(e[9]=S((...i)=>u.submitForm&&u.submitForm(...i),["prevent"]))},[s("div",E,[e[15]||(e[15]=s("label",null,"Lieu *",-1)),s("div",_,[m(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=i=>r.lieuSearch=i),onFocus:e[2]||(e[2]=i=>r.showLieuSuggestions=!0),onBlur:e[3]||(e[3]=(...i)=>u.hideLieuSuggestions&&u.hideLieuSuggestions(...i)),onInput:e[4]||(e[4]=(...i)=>u.filterLieux&&u.filterLieux(...i)),placeholder:r.formData.lieuId?u.getLieuName(r.formData.lieuId):"Rechercher un lieu...",required:"",class:"combobox-input"},null,40,C),[[h,r.lieuSearch]]),r.showLieuSuggestions&&r.filteredLieux.length?(l(),n("ul",V,[(l(!0),n(g,null,v(r.filteredLieux,i=>(l(),n("li",{key:i.id,onMousedown:y=>u.selectLieu(i),class:"suggestion-item"},a(i.nomLieu)+" - "+a(i.projetTitre),41,N))),128))])):p("",!0),r.showLieuSuggestions&&r.filteredLieux.length===0?(l(),n("ul",j,[...e[14]||(e[14]=[s("li",{class:"suggestion-item no-results"},"Aucun lieu trouv√©",-1)])])):p("",!0)])]),s("div",F,[e[16]||(e[16]=s("label",null,"Nom du plateau *",-1)),m(s("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>r.formData.nom=i),type:"text",required:"",placeholder:"Ex: Plateau principal, Plateau ext√©rieur..."},null,512),[[h,r.formData.nom]])]),s("div",M,[e[18]||(e[18]=s("label",null,"Type de plateau *",-1)),m(s("select",{"onUpdate:modelValue":e[6]||(e[6]=i=>r.formData.typePlateau=i),required:""},[...e[17]||(e[17]=[L('<option value="" data-v-dd282d7f>S√©lectionnez un type</option><option value="Int√©rieur" data-v-dd282d7f>Int√©rieur</option><option value="Ext√©rieur" data-v-dd282d7f>Ext√©rieur</option><option value="Studio" data-v-dd282d7f>Studio</option><option value="Naturel" data-v-dd282d7f>Naturel</option><option value="D√©cor" data-v-dd282d7f>D√©cor</option><option value="Virtuel" data-v-dd282d7f>Virtuel</option>',7)])],512),[[x,r.formData.typePlateau]])]),s("div",U,[e[19]||(e[19]=s("label",null,"Description",-1)),m(s("textarea",{"onUpdate:modelValue":e[7]||(e[7]=i=>r.formData.description=i),rows:"3",placeholder:"Description du plateau..."},null,512),[[h,r.formData.description]])]),s("button",A,a(r.isEditing?"Modifier":"Ajouter")+" le plateau",1),r.isEditing?(l(),n("button",{key:0,type:"button",onClick:e[8]||(e[8]=(...i)=>u.resetForm&&u.resetForm(...i)),class:"cancel-btn"},"Annuler")):p("",!0)],32)]),s("div",B,[e[30]||(e[30]=s("h3",null,"Liste des plateaux",-1)),s("div",q,[s("div",R,[m(s("input",{"onUpdate:modelValue":e[10]||(e[10]=i=>r.searchTerm=i),type:"text",placeholder:"Rechercher par nom..."},null,512),[[h,r.searchTerm]])]),s("div",O,[m(s("select",{"onUpdate:modelValue":e[11]||(e[11]=i=>r.filterLieuId=i)},[e[20]||(e[20]=s("option",{value:""},"Tous les lieux",-1)),(l(!0),n(g,null,v(r.lieux,i=>(l(),n("option",{key:i.id,value:i.id},a(i.nomLieu),9,z))),128))],512),[[x,r.filterLieuId]])]),s("div",G,[m(s("select",{"onUpdate:modelValue":e[12]||(e[12]=i=>r.filterTypePlateau=i)},[...e[21]||(e[21]=[L('<option value="" data-v-dd282d7f>Tous les types</option><option value="Int√©rieur" data-v-dd282d7f>Int√©rieur</option><option value="Ext√©rieur" data-v-dd282d7f>Ext√©rieur</option><option value="Studio" data-v-dd282d7f>Studio</option><option value="Naturel" data-v-dd282d7f>Naturel</option><option value="D√©cor" data-v-dd282d7f>D√©cor</option><option value="Virtuel" data-v-dd282d7f>Virtuel</option>',7)])],512),[[x,r.filterTypePlateau]])])]),r.loading?(l(),n("div",J,"Chargement des plateaux...")):u.filteredPlateaux.length===0?(l(),n("div",H," Aucun plateau trouv√©. ")):(l(),n("div",K,[(l(!0),n(g,null,v(u.filteredPlateaux,i=>(l(),n("div",{key:i.id,class:"plateau-card"},[s("div",Q,[s("h4",null,a(i.nom),1),s("div",W,[s("span",{class:"icon-edit",onClick:y=>u.editPlateau(i)},"‚úèÔ∏è",8,X),s("span",{class:"icon-delete",onClick:y=>u.deletePlateau(i.id)},"üóëÔ∏è",8,Y)])]),s("div",Z,[s("p",null,[e[22]||(e[22]=s("strong",null,"Type:",-1)),c(" "+a(i.typePlateau),1)]),s("p",null,[e[23]||(e[23]=s("strong",null,"Lieu:",-1)),c(" "+a(i.lieuNom),1)]),i.sceneTitre?(l(),n("p",$,[e[24]||(e[24]=s("strong",null,"Sc√®ne:",-1)),c(" "+a(i.sceneTitre),1)])):p("",!0),i.sequenceTitre?(l(),n("p",ee,[e[25]||(e[25]=s("strong",null,"S√©quence:",-1)),c(" "+a(i.sequenceTitre),1)])):p("",!0),i.episodeTitre?(l(),n("p",te,[e[26]||(e[26]=s("strong",null,"√âpisode:",-1)),c(" "+a(i.episodeTitre),1)])):p("",!0),i.projetTitre?(l(),n("p",ie,[e[27]||(e[27]=s("strong",null,"Projet:",-1)),c(" "+a(i.projetTitre),1)])):p("",!0),i.description?(l(),n("p",se,[e[28]||(e[28]=s("strong",null,"Description:",-1)),c(" "+a(i.description),1)])):p("",!0),s("p",null,[e[29]||(e[29]=s("strong",null,"Cr√©√© le:",-1)),c(" "+a(u.formatDate(i.creeLe)),1)])])]))),128))]))])])])}const le=I(w,[["render",re],["__scopeId","data-v-dd282d7f"]]);export{le as default};
