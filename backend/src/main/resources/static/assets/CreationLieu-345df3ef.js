import{_ as x,a as c,A as P,o as n,c as l,b as t,t as u,h as L,w as f,v as j,F as h,r as v,e as g,f as y,g as S,d as p}from"./index-c433af20.js";const w={name:"CreationLieu",data(){return{user:JSON.parse(localStorage.getItem("user"))||null,showProfileMenu:!1,formData:{projetId:"",nomLieu:"",typeLieu:"",adresse:""},isEditing:!1,editingId:null,projets:[],lieux:[],searchTerm:"",filterProjetId:"",filterTypeLieu:"",loading:!0,showScenesModal:!1,selectedLieu:{},selectedLieuScenes:[],projetSearch:"",showProjetSuggestions:!1,filteredProjets:[]}},computed:{userInitials(){var e;return(e=this.user)!=null&&e.nom?this.user.nom.split(" ").map(i=>i[0]).join("").toUpperCase():""},filteredLieux(){return this.lieux.filter(o=>{const e=o.nomLieu.toLowerCase().includes(this.searchTerm.toLowerCase()),i=!this.filterProjetId||o.projetId===parseInt(this.filterProjetId),a=!this.filterTypeLieu||o.typeLieu===this.filterTypeLieu;return e&&i&&a})}},async created(){c.defaults.baseURL=P,c.interceptors.request.use(o=>{const e=localStorage.getItem("token");return e&&(o.headers.Authorization=`Bearer ${e}`),o},o=>Promise.reject(o)),await this.loadProjets(),await this.loadLieux(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},watch:{projets:{handler(o){this.filteredProjets=[...o]},deep:!0}},methods:{async loadProjets(){try{const o=await c.get("/api/projets");this.projets=o.data,this.filteredProjets=[...this.projets]}catch(o){console.error("Erreur lors du chargement des projets:",o),alert("Erreur lors du chargement des projets")}},async loadLieux(){var o,e;this.loading=!0;try{const i=await c.get("/api/lieux");this.lieux=i.data;for(let a of this.lieux)try{const r=await c.get(`/api/scene-lieux/lieux/${a.id}`);a.sceneCount=r.data.length,r.data.length>0&&(a.scenes=r.data.slice(0,3))}catch(r){console.error("Erreur lors du chargement des sc√®nes du lieu:",r),a.sceneCount=0,a.scenes=[]}}catch(i){console.error("Erreur lors du chargement des lieux:",i),alert("Erreur lors du chargement des lieux: "+(((e=(o=i.response)==null?void 0:o.data)==null?void 0:e.message)||i.message))}finally{this.loading=!1}},async submitForm(){var o,e;try{const i={...this.formData,projetId:parseInt(this.formData.projetId)};this.isEditing?(await c.put(`/api/lieux/${this.editingId}`,i),alert("Lieu modifi√© avec succ√®s!")):(await c.post("/api/lieux",i),alert("Lieu cr√©√© avec succ√®s!")),this.resetForm(),await this.loadLieux()}catch(i){console.error("Erreur lors de la sauvegarde du lieu:",i),alert("Erreur: "+(((e=(o=i.response)==null?void 0:o.data)==null?void 0:e.message)||i.message))}},editLieu(o){this.formData={projetId:o.projetId.toString(),nomLieu:o.nomLieu,typeLieu:o.typeLieu,adresse:o.adresse||""},this.projetSearch=this.getProjetName(o.projetId),this.isEditing=!0,this.editingId=o.id,document.querySelector(".creation-form").scrollIntoView({behavior:"smooth"})},async deleteLieu(o){var e,i;if(confirm("√ätes-vous s√ªr de vouloir supprimer ce lieu ?"))try{await c.delete(`/api/lieux/${o}`),await this.loadLieux(),alert("Lieu supprim√© avec succ√®s!")}catch(a){console.error("Erreur lors de la suppression du lieu:",a),alert("Erreur: "+(((i=(e=a.response)==null?void 0:e.data)==null?void 0:i.message)||a.message))}},resetForm(){this.formData={projetId:"",nomLieu:"",typeLieu:"",adresse:""},this.projetSearch="",this.isEditing=!1,this.editingId=null,this.filteredProjets=[...this.projets]},formatDate(o){return o?new Date(o).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):""},async viewLieuScenes(o){this.selectedLieu=o;try{const e=await c.get(`/api/scene-lieux/lieux/${o.id}`);this.selectedLieuScenes=e.data,this.showScenesModal=!0}catch(e){console.error("Erreur lors du chargement des sc√®nes du lieu:",e),alert("Erreur lors du chargement des sc√®nes")}},goBack(){this.$router.push("/scenariste")},toggleProfileMenu(){this.showProfileMenu=!this.showProfileMenu},handleClickOutside(o){o.target.closest(".profile-section")||(this.showProfileMenu=!1)},seDeconnecter(){localStorage.removeItem("user"),localStorage.removeItem("token"),this.$router.push("/")},async loadScenesForProject(){},filterProjets(){const o=this.projetSearch.toLowerCase();if(!o){this.filteredProjets=[...this.projets];return}this.filteredProjets=this.projets.filter(e=>e.titre.toLowerCase().includes(o)||e.genreNom&&e.genreNom.toLowerCase().includes(o))},selectProjet(o){this.formData.projetId=o.id.toString(),this.projetSearch=`${o.titre} (${o.genreNom})`,this.showProjetSuggestions=!1},hideProjetSuggestions(){setTimeout(()=>{this.showProjetSuggestions=!1},200)},getProjetName(o){const e=this.projets.find(i=>i.id===parseInt(o));return e?`${e.titre} (${e.genreNom})`:""}}},k={class:"creation-lieu-container"},I={class:"main-content"},b={class:"page-header"},E={class:"creation-form"},C={class:"form-group"},T={class:"combobox-container"},D=["placeholder"],_={key:0,class:"suggestions-list"},M=["onMousedown"],N={key:1,class:"suggestions-list"},U={class:"form-group"},A={class:"form-group"},F={class:"form-group"},V={type:"submit",class:"submit-btn"},B={class:"lieux-list"},R={class:"filters"},q={class:"filter-group"},O={class:"filter-group"},z=["value"],G={class:"filter-group"},J={key:0,class:"loading"},H={key:1,class:"no-data"},K={key:2,class:"lieux-grid"},Q={class:"lieu-header"},W={class:"lieu-actions"},X=["onClick"],Y=["onClick"],Z=["onClick"],$={class:"lieu-info"},ee={key:0},te={key:0,class:"scenes-section"},se={class:"modal-header"},oe={class:"scenes-list"},re={key:0,class:"no-scenes"},ie={key:1},ne={class:"modal-actions"};function le(o,e,i,a,r,d){return n(),l("div",k,[t("main",I,[t("div",b,[t("button",{onClick:e[0]||(e[0]=(...s)=>d.goBack&&d.goBack(...s)),class:"back-btn"},"‚Üê Retour"),e[17]||(e[17]=t("h2",null,"Gestion des Lieux",-1))]),t("div",E,[t("h3",null,u(r.isEditing?"Modifier":"Ajouter")+" un lieu",1),t("form",{onSubmit:e[9]||(e[9]=L((...s)=>d.submitForm&&d.submitForm(...s),["prevent"]))},[t("div",C,[e[19]||(e[19]=t("label",null,"Projet *",-1)),t("div",T,[f(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>r.projetSearch=s),onFocus:e[2]||(e[2]=s=>r.showProjetSuggestions=!0),onBlur:e[3]||(e[3]=(...s)=>d.hideProjetSuggestions&&d.hideProjetSuggestions(...s)),onInput:e[4]||(e[4]=(...s)=>d.filterProjets&&d.filterProjets(...s)),placeholder:r.formData.projetId?d.getProjetName(r.formData.projetId):"Rechercher un projet...",required:"",class:"combobox-input"},null,40,D),[[j,r.projetSearch]]),r.showProjetSuggestions&&r.filteredProjets.length?(n(),l("ul",_,[(n(!0),l(h,null,v(r.filteredProjets,s=>(n(),l("li",{key:s.id,onMousedown:m=>d.selectProjet(s),class:"suggestion-item"},u(s.titre)+" ("+u(s.genreNom)+") ",41,M))),128))])):g("",!0),r.showProjetSuggestions&&r.filteredProjets.length===0?(n(),l("ul",N,[...e[18]||(e[18]=[t("li",{class:"suggestion-item no-results"},"Aucun projet trouv√©",-1)])])):g("",!0)])]),t("div",U,[e[20]||(e[20]=t("label",null,"Nom du lieu *",-1)),f(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>r.formData.nomLieu=s),type:"text",required:"",placeholder:"Ex: Appartement principal, Rue de Paris..."},null,512),[[j,r.formData.nomLieu]])]),t("div",A,[e[22]||(e[22]=t("label",null,"Type de lieu *",-1)),f(t("select",{"onUpdate:modelValue":e[6]||(e[6]=s=>r.formData.typeLieu=s),required:""},[...e[21]||(e[21]=[S('<option value="" data-v-8d4250f2>S√©lectionnez un type</option><option value="Int√©rieur" data-v-8d4250f2>Int√©rieur</option><option value="Ext√©rieur" data-v-8d4250f2>Ext√©rieur</option><option value="Int√©rieur/Ext√©rieur" data-v-8d4250f2>Int√©rieur/Ext√©rieur</option><option value="Studio" data-v-8d4250f2>Studio</option><option value="Naturel" data-v-8d4250f2>Naturel</option><option value="Urbain" data-v-8d4250f2>Urbain</option>',7)])],512),[[y,r.formData.typeLieu]])]),t("div",F,[e[23]||(e[23]=t("label",null,"Adresse",-1)),f(t("textarea",{"onUpdate:modelValue":e[7]||(e[7]=s=>r.formData.adresse=s),rows:"3",placeholder:"Adresse compl√®te du lieu..."},null,512),[[j,r.formData.adresse]])]),t("button",V,u(r.isEditing?"Modifier":"Ajouter")+" le lieu",1),r.isEditing?(n(),l("button",{key:0,type:"button",onClick:e[8]||(e[8]=(...s)=>d.resetForm&&d.resetForm(...s)),class:"cancel-btn"},"Annuler")):g("",!0)],32)]),t("div",B,[e[32]||(e[32]=t("h3",null,"Liste des lieux",-1)),t("div",R,[t("div",q,[f(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>r.searchTerm=s),type:"text",placeholder:"Rechercher par nom..."},null,512),[[j,r.searchTerm]])]),t("div",O,[f(t("select",{"onUpdate:modelValue":e[11]||(e[11]=s=>r.filterProjetId=s)},[e[24]||(e[24]=t("option",{value:""},"Tous les projets",-1)),(n(!0),l(h,null,v(r.projets,s=>(n(),l("option",{key:s.id,value:s.id},u(s.titre),9,z))),128))],512),[[y,r.filterProjetId]])]),t("div",G,[f(t("select",{"onUpdate:modelValue":e[12]||(e[12]=s=>r.filterTypeLieu=s)},[...e[25]||(e[25]=[S('<option value="" data-v-8d4250f2>Tous les types</option><option value="Int√©rieur" data-v-8d4250f2>Int√©rieur</option><option value="Ext√©rieur" data-v-8d4250f2>Ext√©rieur</option><option value="Int√©rieur/Ext√©rieur" data-v-8d4250f2>Int√©rieur/Ext√©rieur</option><option value="Studio" data-v-8d4250f2>Studio</option><option value="Naturel" data-v-8d4250f2>Naturel</option><option value="Urbain" data-v-8d4250f2>Urbain</option>',7)])],512),[[y,r.filterTypeLieu]])])]),r.loading?(n(),l("div",J,"Chargement des lieux...")):d.filteredLieux.length===0?(n(),l("div",H," Aucun lieu trouv√©. ")):(n(),l("div",K,[(n(!0),l(h,null,v(d.filteredLieux,s=>(n(),l("div",{key:s.id,class:"lieu-card"},[t("div",Q,[t("h4",null,u(s.nomLieu),1),t("div",W,[t("span",{class:"icon-edit",onClick:m=>d.editLieu(s)},"‚úèÔ∏è",8,X),t("span",{class:"icon-delete",onClick:m=>d.deleteLieu(s.id)},"üóëÔ∏è",8,Y),t("span",{class:"icon-scenes",onClick:m=>d.viewLieuScenes(s),title:"Voir les sc√®nes utilisant ce lieu"}," üé¨ ",8,Z)])]),t("div",$,[t("p",null,[e[26]||(e[26]=t("strong",null,"Projet:",-1)),p(" "+u(s.projetTitre),1)]),t("p",null,[e[27]||(e[27]=t("strong",null,"Type:",-1)),p(" "+u(s.typeLieu),1)]),s.adresse?(n(),l("p",ee,[e[28]||(e[28]=t("strong",null,"Adresse:",-1)),p(" "+u(s.adresse),1)])):g("",!0),t("p",null,[e[29]||(e[29]=t("strong",null,"Cr√©√© le:",-1)),p(" "+u(d.formatDate(s.creeLe)),1)]),t("p",null,[e[30]||(e[30]=t("strong",null,"Sc√®nes associ√©es:",-1)),p(" "+u(s.sceneCount||0),1)])]),s.scenes&&s.scenes.length?(n(),l("div",te,[e[31]||(e[31]=t("h5",null,"Sc√®nes utilisant ce lieu:",-1)),(n(!0),l(h,null,v(s.scenes,m=>(n(),l("div",{key:m.id,class:"scene-item"},[t("span",null,u(m.titre)+" ("+u(m.descriptionUtilisation)+")",1)]))),128))])):g("",!0)]))),128))]))]),r.showScenesModal?(n(),l("div",{key:0,class:"modal-overlay",onClick:e[16]||(e[16]=s=>r.showScenesModal=!1)},[t("div",{class:"modal-content",onClick:e[15]||(e[15]=L(()=>{},["stop"]))},[t("div",se,[t("h3",null,'Sc√®nes utilisant "'+u(r.selectedLieu.nomLieu)+'"',1),t("button",{class:"modal-close",onClick:e[13]||(e[13]=s=>r.showScenesModal=!1)},"√ó")]),t("div",oe,[r.selectedLieuScenes.length===0?(n(),l("div",re," Aucune sc√®ne n'utilise ce lieu. ")):(n(),l("div",ie,[(n(!0),l(h,null,v(r.selectedLieuScenes,s=>(n(),l("div",{key:s.id,class:"scene-detail"},[t("h4",null,u(s.sceneTitre),1),t("p",null,[e[33]||(e[33]=t("strong",null,"S√©quence:",-1)),p(" "+u(s.sequenceTitre),1)]),t("p",null,[e[34]||(e[34]=t("strong",null,"√âpisode:",-1)),p(" "+u(s.episodeTitre),1)]),t("p",null,[e[35]||(e[35]=t("strong",null,"Projet:",-1)),p(" "+u(s.projetTitre),1)]),t("p",null,[e[36]||(e[36]=t("strong",null,"Utilisation:",-1)),p(" "+u(s.descriptionUtilisation),1)])]))),128))]))]),t("div",ne,[t("button",{type:"button",onClick:e[14]||(e[14]=s=>r.showScenesModal=!1),class:"cancel-btn"},"Fermer")])])])):g("",!0)])])}const de=x(w,[["render",le],["__scopeId","data-v-8d4250f2"]]);export{de as default};
