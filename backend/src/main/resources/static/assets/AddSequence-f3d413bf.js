import{_ as h,a as l,o as n,c as a,b as r,h as f,w as u,v as m,n as b,t as c,e as g,d as v,f as q,F as y,r as S}from"./index-c433af20.js";const E={data(){return{user:JSON.parse(localStorage.getItem("user"))||null,showProfileMenu:!1,episode:{},statutsSequence:[],existingOrders:[],formData:{titre:"",ordre:null,synopsis:"",statutId:null},loading:!1,ordreError:"",suggestedOrdre:null}},computed:{userInitials(){var e;return(e=this.user)!=null&&e.nom?this.user.nom.split(" ").map(d=>d[0]).join("").toUpperCase():""},episodeId(){return this.$route.params.id||this.$route.params.episodeId}},async created(){await this.loadEpisode(),await this.loadStatutsSequence(),await this.fetchExistingSequences(),document.addEventListener("click",this.handleClickOutside)},beforeDestroy(){document.removeEventListener("click",this.handleClickOutside)},methods:{async loadEpisode(){var t;try{console.log("ID d'épisode récupéré:",this.episodeId),console.log("Route params:",this.$route.params);const e=await l.get(`/api/episodes/${this.episodeId}`,{headers:{"X-User-Id":this.user.id}});this.episode=e.data}catch(e){console.error("Erreur lors du chargement de l'épisode:",e),console.error("Détails de l'erreur:",(t=e.response)==null?void 0:t.data),alert("Impossible de charger les détails de l'épisode")}},async loadStatutsSequence(){try{const t=await l.get("/api/statuts-sequence");this.statutsSequence=t.data}catch(t){console.error("Erreur lors du chargement des statuts:",t),alert("Impossible de charger les statuts disponibles")}},async fetchExistingSequences(){try{const t=await l.get(`/api/sequences/episodes/${this.episodeId}`);this.existingOrders=t.data.map(e=>e.ordre),this.calculateSuggestedOrdre()}catch(t){console.error("Erreur lors du chargement des séquences existantes:",t)}},calculateSuggestedOrdre(){if(this.existingOrders.length===0){this.suggestedOrdre=1,this.formData.ordre=1;return}const t=Math.max(...this.existingOrders);this.suggestedOrdre=t+1,this.formData.ordre=this.suggestedOrdre},validateOrdre(){if(!this.formData.ordre){this.ordreError="L'ordre est requis";return}const t=parseInt(this.formData.ordre);if(t<1){this.ordreError="L'ordre doit être au moins 1";return}if(this.existingOrders.includes(t)){this.ordreError=`L'ordre ${t} existe déjà pour cet épisode. Veuillez choisir un autre numéro.`;return}this.ordreError=""},async submitForm(){var t,e,d,p,o,i;if(this.validateOrdre(),!this.ordreError){this.loading=!0;try{await l.post(`/api/sequences/episodes/${this.episodeId}`,this.formData),alert("Séquence créée avec succès!"),this.goBackToEpisodeDetails()}catch(s){console.error("Erreur lors de la création de la séquence:",s),((t=s.response)==null?void 0:t.status)===400&&((p=(d=(e=s.response)==null?void 0:e.data)==null?void 0:d.message)!=null&&p.includes("ordre"))?this.ordreError="Cet ordre existe déjà pour cet épisode. Veuillez choisir un autre numéro.":alert("Erreur lors de la création de la séquence: "+(((i=(o=s.response)==null?void 0:o.data)==null?void 0:i.message)||"Veuillez réessayer"))}finally{this.loading=!1}}},goBack(){this.$router.go(-1)},goBackToEpisodeDetails(){this.$router.push(`/episode/${this.episodeId}/detail-episode`)},toggleProfileMenu(){this.showProfileMenu=!this.showProfileMenu},handleClickOutside(t){t.target.closest(".profile-section")||(this.showProfileMenu=!1)},seDeconnecter(){localStorage.removeItem("user"),localStorage.removeItem("token"),this.$router.push("/")}}},O={class:"add-sequence-container"},D={class:"main-content"},k={class:"sequence-header"},x={class:"add-sequence-form"},I={class:"form-group"},_={class:"form-group"},w={key:0,class:"error-text"},C={key:1,class:"suggestion-text"},B={class:"form-group"},V={class:"form-group"},M=["value"],z={class:"form-group"},L=["value"],U={class:"form-actions"},N=["disabled"];function F(t,e,d,p,o,i){return n(),a("div",O,[r("main",D,[r("div",k,[r("button",{onClick:e[0]||(e[0]=(...s)=>i.goBack&&i.goBack(...s)),class:"back-btn"},"← Retour"),e[9]||(e[9]=r("h2",null,"Ajouter une nouvelle séquence",-1))]),r("div",x,[r("form",{onSubmit:e[8]||(e[8]=f((...s)=>i.submitForm&&i.submitForm(...s),["prevent"]))},[r("div",I,[e[10]||(e[10]=r("label",{for:"titre"},"Titre de la séquence *",-1)),u(r("input",{id:"titre","onUpdate:modelValue":e[1]||(e[1]=s=>o.formData.titre=s),type:"text",required:"",placeholder:"Entrez le titre de la séquence"},null,512),[[m,o.formData.titre]])]),r("div",_,[e[11]||(e[11]=r("label",{for:"ordre"},"Ordre dans l'épisode *",-1)),u(r("input",{id:"ordre","onUpdate:modelValue":e[2]||(e[2]=s=>o.formData.ordre=s),type:"number",min:"1",required:"",placeholder:"Numéro d'ordre",class:b({"error-input":o.ordreError}),onBlur:e[3]||(e[3]=(...s)=>i.validateOrdre&&i.validateOrdre(...s))},null,34),[[m,o.formData.ordre]]),o.ordreError?(n(),a("span",w,c(o.ordreError),1)):g("",!0),o.suggestedOrdre?(n(),a("span",C,[v(" Suggestion: Le prochain ordre disponible est "+c(o.suggestedOrdre)+" ",1),r("button",{type:"button",onClick:e[4]||(e[4]=(...s)=>t.useSuggestedOrder&&t.useSuggestedOrder(...s)),class:"suggestion-btn"}," Utiliser cette valeur ")])):g("",!0)]),r("div",B,[e[12]||(e[12]=r("label",{for:"synopsis"},"Synopsis *",-1)),u(r("textarea",{id:"synopsis","onUpdate:modelValue":e[5]||(e[5]=s=>o.formData.synopsis=s),required:"",rows:"5",placeholder:"Décrivez le contenu de cette séquence"},null,512),[[m,o.formData.synopsis]])]),r("div",V,[e[13]||(e[13]=r("label",{for:"episode"},"Épisode lié",-1)),r("input",{id:"episode",value:o.episode.titre,type:"text",disabled:""},null,8,M)]),r("div",z,[e[15]||(e[15]=r("label",{for:"statut"},"Statut *",-1)),u(r("select",{id:"statut","onUpdate:modelValue":e[6]||(e[6]=s=>o.formData.statutId=s),required:""},[e[14]||(e[14]=r("option",{value:"",disabled:""},"Sélectionnez un statut",-1)),(n(!0),a(y,null,S(o.statutsSequence,s=>(n(),a("option",{key:s.id,value:s.id},c(s.nomStatutsSequence),9,L))),128))],512),[[q,o.formData.statutId]])]),r("div",U,[r("button",{type:"submit",class:"submit-btn",disabled:o.loading||o.ordreError!==""},c(o.loading?"Création en cours...":"Créer la séquence"),9,N),r("button",{type:"button",onClick:e[7]||(e[7]=(...s)=>i.goBack&&i.goBack(...s)),class:"cancel-btn"}," Annuler ")])],32)])])])}const T=h(E,[["render",F],["__scopeId","data-v-e9411b34"]]);export{T as default};
